{"version":3,"file":"drawing.js","sources":["drawing.js"],"sourcesContent":["/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { createPromise } from \"../util\";\nimport { parseColor as utils_parseColor, saveAs as util_saveAs, support } from \"../common\";\nimport * as PDF from \"./core\";\nimport { Group, MultiPath, Gradient, RadialGradient } from '../drawing';\nimport * as geo from \"../geometry\";\n\nvar TEXT_RENDERING_MODE = PDF.TEXT_RENDERING_MODE;\n\nvar DASH_PATTERNS = {\n    dash           : [ 4 ],\n    dashDot        : [ 4, 2, 1, 2 ],\n    dot            : [ 1, 2 ],\n    longDash       : [ 8, 2 ],\n    longDashDot    : [ 8, 2, 1, 2 ],\n    longDashDotDot : [ 8, 2, 1, 2, 1, 2 ],\n    solid          : []\n};\n\nvar LINE_CAP = {\n    butt   : 0,\n    round  : 1,\n    square : 2\n};\n\nvar LINE_JOIN = {\n    miter : 0,\n    round : 1,\n    bevel : 2\n};\n\nfunction render(group, callback) {\n    var fonts = [], images = {}, options = group.options;\n\n    function getOption(name, defval, hash) {\n        if (!hash) {\n            hash = options;\n        }\n        if (hash.pdf && hash.pdf[name] != null) {\n            return hash.pdf[name];\n        }\n        return defval;\n    }\n\n    var multiPage = getOption(\"multiPage\");\n    var imgDPI = getOption(\"imgDPI\");\n\n    if (imgDPI) {\n        PDF.clearImageCache();\n    }\n\n    group.traverse(function(element){\n        dispatch({\n            Image: function(element) {\n                var url = element.src();\n                if (imgDPI) {\n                    var box = element.bbox().size;\n                    var prev = images[url];\n                    box = {\n                        width: Math.ceil(box.width * imgDPI / 72),\n                        height: Math.ceil(box.height * imgDPI / 72)\n                    };\n                    if (prev) {\n                        box.width = Math.max(prev.width, box.width);\n                        box.height = Math.max(prev.height, box.height);\n                    }\n                    images[url] = box;\n                } else {\n                    images[url] = null;\n                }\n            },\n            Text: function(element) {\n                var style = PDF.parseFontDef(element.options.font);\n                var url = PDF.getFontURL(style);\n                if (fonts.indexOf(url) < 0) {\n                    fonts.push(url);\n                }\n            }\n        }, element);\n    });\n\n    function doIt() {\n        if (--count > 0) {\n            return;\n        }\n\n        var pdf = new (PDF.Document)({\n            producer  : getOption(\"producer\"),\n            title     : getOption(\"title\"),\n            author    : getOption(\"author\"),\n            subject   : getOption(\"subject\"),\n            keywords  : getOption(\"keywords\"),\n            creator   : getOption(\"creator\"),\n            date      : getOption(\"date\")\n        });\n\n        function drawPage(group) {\n            var options = group.options;\n\n            var tmp = optimize(group);\n            var bbox = tmp.bbox;\n            group = tmp.root;\n            // var tmp, bbox;\n\n            var paperSize = getOption(\"paperSize\", getOption(\"paperSize\", \"auto\"), options), addMargin = false;\n            if (paperSize == \"auto\") {\n                if (bbox) {\n                    var size = bbox.getSize();\n                    paperSize = [ size.width, size.height ];\n                    addMargin = true;\n                    var origin = bbox.getOrigin();\n                    tmp = new Group();\n                    tmp.transform(new geo.Matrix(1, 0, 0, 1, -origin.x, -origin.y));\n                    tmp.append(group);\n                    group = tmp;\n                }\n                else {\n                    paperSize = \"A4\";\n                }\n            }\n\n            var page;\n            page = pdf.addPage({\n                paperSize : paperSize,\n                margin    : getOption(\"margin\", getOption(\"margin\"), options),\n                addMargin : addMargin,\n                landscape : getOption(\"landscape\", getOption(\"landscape\", false), options)\n            });\n            drawElement(group, page, pdf);\n        }\n\n        if (multiPage) {\n            group.children.forEach(drawPage);\n        } else {\n            drawPage(group);\n        }\n\n        callback(pdf.render(), pdf);\n    }\n\n    var count = 2;\n    PDF.loadFonts(fonts, doIt);\n    PDF.loadImages(images, doIt);\n}\n\nfunction toDataURL(group, callback) {\n    render(group, function(data){\n        callback(\"data:application/pdf;base64,\" + data.base64());\n    });\n}\n\nfunction toBlob(group, callback) {\n    render(group, function(data){\n        callback(new window.Blob([ data.get() ], { type: \"application/pdf\" }));\n    });\n}\n\nfunction saveAs(group, filename, proxy, callback) {\n    // XXX: Safari has Blob, but does not support the download attribute\n    //      so we'd end up converting to dataURL and using the proxy anyway.\n    if (window.Blob && !support.browser.safari) {\n        toBlob(group, function(blob){\n            util_saveAs({ dataURI: blob, fileName: filename });\n            if (callback) {\n                callback(blob);\n            }\n        });\n    } else {\n        toDataURL(group, function(dataURL){\n            util_saveAs({ dataURI: dataURL, fileName: filename, proxyURL: proxy });\n            if (callback) {\n                callback(dataURL);\n            }\n        });\n    }\n}\n\nfunction dispatch(handlers, element) {\n    var handler = handlers[element.nodeType];\n    if (handler) {\n        return handler.call.apply(handler, arguments);\n    }\n    return element;\n}\n\nfunction drawElement(element, page, pdf) {\n    if (element.options._pdfDebug) {\n        page.comment(\"BEGIN: \" + element.options._pdfDebug);\n    }\n\n    var transform = element.transform();\n    var opacity = element.opacity();\n\n    page.save();\n\n    if (opacity != null && opacity < 1) {\n        page.setOpacity(opacity);\n    }\n\n    setStrokeOptions(element, page, pdf);\n    setFillOptions(element, page, pdf);\n\n    if (transform) {\n        var m = transform.matrix();\n        page.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n    }\n\n    setClipping(element, page, pdf);\n\n    dispatch({\n        Path      : drawPath,\n        MultiPath : drawMultiPath,\n        Circle    : drawCircle,\n        Arc       : drawArc,\n        Text      : drawText,\n        Image     : drawImage,\n        Group     : drawGroup,\n        Rect      : drawRect\n    }, element, page, pdf);\n\n    page.restore();\n\n    if (element.options._pdfDebug) {\n        page.comment(\"END: \" + element.options._pdfDebug);\n    }\n}\n\nfunction setStrokeOptions(element, page) {\n    var stroke = element.stroke && element.stroke();\n    if (!stroke) {\n        return;\n    }\n\n    var color = stroke.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no stroke\n        }\n        page.setStrokeColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setStrokeOpacity(color.a);\n        }\n    }\n\n    var width = stroke.width;\n    if (width != null) {\n        if (width === 0) {\n            return; // no stroke\n        }\n        page.setLineWidth(width);\n    }\n\n    var dashType = stroke.dashType;\n    if (dashType) {\n        page.setDashPattern(DASH_PATTERNS[dashType], 0);\n    }\n\n    var lineCap = stroke.lineCap;\n    if (lineCap) {\n        page.setLineCap(LINE_CAP[lineCap]);\n    }\n\n    var lineJoin = stroke.lineJoin;\n    if (lineJoin) {\n        page.setLineJoin(LINE_JOIN[lineJoin]);\n    }\n\n    var opacity = stroke.opacity;\n    if (opacity != null) {\n        page.setStrokeOpacity(opacity);\n    }\n}\n\nfunction setFillOptions(element, page) {\n    var fill = element.fill && element.fill();\n    if (!fill) {\n        return;\n    }\n\n    if (fill instanceof Gradient) {\n        return;\n    }\n\n    var color = fill.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no fill\n        }\n        page.setFillColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setFillOpacity(color.a);\n        }\n    }\n\n    var opacity = fill.opacity;\n    if (opacity != null) {\n        page.setFillOpacity(opacity);\n    }\n}\n\nfunction setClipping(element, page, pdf) {\n    // XXX: only Path supported at the moment.\n    var clip = element.clip();\n    if (clip) {\n        _drawPath(clip, page, pdf);\n        page.clip();\n        // page.setStrokeColor(Math.random(), Math.random(), Math.random());\n        // page.setLineWidth(1);\n        // page.stroke();\n    }\n}\n\nfunction shouldDraw(thing) {\n    return (thing &&\n            (thing instanceof Gradient ||\n             (thing.color && !/^(none|transparent)$/i.test(thing.color) &&\n              (thing.width == null || thing.width > 0) &&\n              (thing.opacity == null || thing.opacity > 0))));\n}\n\nfunction maybeGradient(element, page, pdf, stroke) {\n    var fill = element.fill();\n    if (fill instanceof Gradient) {\n        if (stroke) {\n            page.clipStroke();\n        } else {\n            page.clip();\n        }\n        var isRadial = fill instanceof RadialGradient;\n        var start, end;\n        if (isRadial) {\n            start = { x: fill.center().x , y: fill.center().y , r: 0 };\n            end   = { x: fill.center().x , y: fill.center().y , r: fill.radius() };\n        } else {\n            start = { x: fill.start().x , y: fill.start().y };\n            end   = { x: fill.end().x   , y: fill.end().y   };\n        }\n\n        var stops = fill.stops.elements().map(function(stop){\n            var offset = stop.offset();\n            if (/%$/.test(offset)) {\n                offset = parseFloat(offset) / 100;\n            } else {\n                offset = parseFloat(offset);\n            }\n            var color = parseColor(stop.color());\n            color.a *= stop.opacity();\n            return {\n                offset: offset,\n                color: color\n            };\n        });\n\n        // Duplicats first and last stop to fix\n        // https://github.com/telerik/kendo-ui-core/issues/1782\n        stops.unshift(stops[0]);\n        stops.push(stops[stops.length - 1]);\n\n        var gradient = {\n            userSpace : fill.userSpace(),\n            type      : isRadial ? \"radial\" : \"linear\",\n            start     : start,\n            end       : end,\n            stops     : stops\n        };\n        var box = element.rawBBox();\n        var tl = box.topLeft(), size = box.getSize();\n        box = {\n            left   : tl.x,\n            top    : tl.y,\n            width  : size.width,\n            height : size.height\n        };\n        page.gradient(gradient, box);\n        return true;\n    }\n}\n\nfunction maybeFillStroke(element, page, pdf) {\n    if (shouldDraw(element.fill()) && shouldDraw(element.stroke())) {\n        if (!maybeGradient(element, page, pdf, true)) {\n            page.fillStroke();\n        }\n    } else if (shouldDraw(element.fill())) {\n        if (!maybeGradient(element, page, pdf, false)) {\n            page.fill();\n        }\n    } else if (shouldDraw(element.stroke())) {\n        page.stroke();\n    } else {\n        // we should not get here; the path should have been\n        // optimized away.  but let's be prepared.\n        page.nop();\n    }\n}\n\nfunction maybeDrawRect(path, page) {\n    var segments = path.segments;\n    if (segments.length == 4 && path.options.closed) {\n        // detect if this path looks like a rectangle parallel to the axis\n        var a = [];\n        for (var i = 0; i < segments.length; ++i) {\n            if (segments[i].controlIn()) { // has curve?\n                return false;\n            }\n            a[i] = segments[i].anchor();\n        }\n        // it's a rectangle if the y/x/y/x or x/y/x/y coords of\n        // consecutive points are the same.\n        var isRect = (\n            a[0].y == a[1].y && a[1].x == a[2].x && a[2].y == a[3].y && a[3].x == a[0].x\n        ) || (\n            a[0].x == a[1].x && a[1].y == a[2].y && a[2].x == a[3].x && a[3].y == a[0].y\n        );\n        if (isRect) {\n            // this saves a bunch of instructions in PDF:\n            // moveTo, lineTo, lineTo, lineTo, close -> rect.\n            page.rect(a[0].x, a[0].y,\n                      a[2].x - a[0].x /*width*/,\n                      a[2].y - a[0].y /*height*/);\n            return true;\n        }\n    }\n}\n\nfunction _drawPath(element, page, pdf) {\n    var segments = element.segments;\n    if (segments.length === 0) {\n        return;\n    }\n    if (!maybeDrawRect(element, page, pdf)) {\n        for (var prev, i = 0; i < segments.length; ++i) {\n            var seg = segments[i];\n            var anchor = seg.anchor();\n            if (!prev) {\n                page.moveTo(anchor.x, anchor.y);\n            } else {\n                var prevOut = prev.controlOut();\n                var controlIn = seg.controlIn();\n                if (prevOut && controlIn) {\n                    page.bezier(\n                        prevOut.x   , prevOut.y,\n                        controlIn.x , controlIn.y,\n                        anchor.x    , anchor.y\n                    );\n                } else {\n                    page.lineTo(anchor.x, anchor.y);\n                }\n            }\n            prev = seg;\n        }\n        if (element.options.closed) {\n            page.close();\n        }\n    }\n}\n\nfunction drawPath(element, page, pdf) {\n    _drawPath(element, page, pdf);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawMultiPath(element, page, pdf) {\n    var paths = element.paths;\n    for (var i = 0; i < paths.length; ++i) {\n        _drawPath(paths[i], page, pdf);\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawCircle(element, page, pdf) {\n    var g = element.geometry();\n    page.circle(g.center.x, g.center.y, g.radius);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawArc(element, page, pdf) {\n    var points = element.geometry().curvePoints();\n    page.moveTo(points[0].x, points[0].y);\n    for (var i = 1; i < points.length;) {\n        page.bezier(\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y\n        );\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawText(element, page) {\n    var style = PDF.parseFontDef(element.options.font);\n    var pos = element._position;\n    var mode;\n    if (element.fill() && element.stroke()) {\n        mode = TEXT_RENDERING_MODE.fillAndStroke;\n    } else if (element.fill()) {\n        mode = TEXT_RENDERING_MODE.fill;\n    } else if (element.stroke()) {\n        mode = TEXT_RENDERING_MODE.stroke;\n    }\n\n    page.transform(1, 0, 0, -1, pos.x, pos.y + style.fontSize);\n    page.beginText();\n    page.setFont(PDF.getFontURL(style), style.fontSize);\n    page.setTextRenderingMode(mode);\n    page.showText(element.content(), element._pdfRect ? element._pdfRect.width() : null);\n    page.endText();\n}\n\nfunction drawGroup(element, page, pdf) {\n    if (element._pdfLink) {\n        page.addLink(element._pdfLink.url, element._pdfLink);\n    }\n    var children = element.children;\n    for (var i = 0; i < children.length; ++i) {\n        drawElement(children[i], page, pdf);\n    }\n}\n\nfunction drawImage(element, page) {\n    var url = element.src();\n    if (!url) {\n        return;\n    }\n\n    var rect = element.rect();\n    var tl = rect.getOrigin();\n    var sz = rect.getSize();\n    page.transform(sz.width, 0, 0, -sz.height, tl.x, tl.y + sz.height);\n    page.drawImage(url);\n}\n\nfunction drawRect(element, page, pdf) {\n    var geometry = element.geometry();\n    page.rect(geometry.origin.x, geometry.origin.y, geometry.size.width, geometry.size.height);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction parseColor(value) {\n    var color = utils_parseColor(value, true);\n    return color ? color.toRGB() : null;\n}\n\nfunction optimize(root) {\n    var clipbox = false;\n    var matrix = geo.Matrix.unit();\n    var currentBox = null;\n    var changed;\n    do {\n        changed = false;\n        root = opt(root);\n    } while (root && changed);\n    return { root: root, bbox: currentBox };\n\n    function change(newShape) {\n        changed = true;\n        return newShape;\n    }\n\n    function visible(shape) {\n        return (shape.visible() && shape.opacity() > 0 &&\n                ( shouldDraw(shape.fill()) ||\n                  shouldDraw(shape.stroke()) ));\n    }\n\n    function optArray(a) {\n        var b = [];\n        for (var i = 0; i < a.length; ++i) {\n            var el = opt(a[i]);\n            if (el != null) {\n                b.push(el);\n            }\n        }\n        return b;\n    }\n\n    function withClipping(shape, f) {\n        var saveclipbox = clipbox;\n        var savematrix = matrix;\n\n        if (shape.transform()) {\n            matrix = matrix.multiplyCopy(shape.transform().matrix());\n        }\n\n        var clip = shape.clip();\n        if (clip) {\n            clip = clip.bbox();\n            if (clip) {\n                clip = clip.bbox(matrix);\n                clipbox = clipbox ? geo.Rect.intersect(clipbox, clip) : clip;\n            }\n        }\n\n        try {\n            return f();\n        }\n        finally {\n            clipbox = saveclipbox;\n            matrix = savematrix;\n        }\n    }\n\n    function inClipbox(shape) {\n        if (clipbox == null) {\n            return false;\n        }\n        var box = shape.rawBBox().bbox(matrix);\n        if (clipbox && box) {\n            box = geo.Rect.intersect(box, clipbox);\n        }\n        return box;\n    }\n\n    function opt(shape) {\n        return withClipping(shape, function(){\n            if (!(shape instanceof Group || shape instanceof MultiPath)) {\n                var box = inClipbox(shape);\n                if (!box) {\n                    return change(null);\n                }\n                currentBox = currentBox ? geo.Rect.union(currentBox, box) : box;\n            }\n            return dispatch({\n                Path: function(shape) {\n                    if (shape.segments.length === 0 || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                MultiPath: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    var el = new MultiPath(shape.options);\n                    el.paths = optArray(shape.paths);\n                    if (el.paths.length === 0) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Circle: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Arc: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Text: function(shape) {\n                    if (!/\\S/.test(shape.content()) || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Image: function(shape) {\n                    if (!(shape.visible() && shape.opacity() > 0)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Group: function(shape) {\n                    var el = new Group(shape.options);\n                    el.children = optArray(shape.children);\n                    el._pdfLink = shape._pdfLink;\n                    if (shape !== root && el.children.length === 0 && !shape._pdfLink) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Rect: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                }\n            }, shape);\n        });\n    }\n}\n\nfunction exportPDF(group, options) {\n    var promise = createPromise();\n\n    for (var i in options) {\n        if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n            // This hackish option is set by the page breaking code in drawDOM.  The idea is\n            // that margin is already taken into account there (that's required to do proper\n            // page breaking) and we don't want to set it again here, as it would double the\n            // top-left margin, and truncate the content on bottom/right.\n            continue;\n        }\n        group.options.set(\"pdf.\" + i, options[i]);\n    }\n\n    toDataURL(group, promise.resolve);\n\n    return promise;\n}\n\nexport { exportPDF, saveAs, toDataURL, toBlob, render };\n"],"names":[],"mappings":"AAAA;;;;;AAKA,SAAS,aAAa,QAAQ,SAAS,CAAC;AACxC,SAAS,UAAU,IAAI,gBAAgB,EAAE,MAAM,IAAI,WAAW,EAAE,OAAO,QAAQ,WAAW,CAAC;AAC3F,OAAO,KAAK,GAAG,MAAM,QAAQ,CAAC;AAC9B,SAAS,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,cAAc,QAAQ,YAAY,CAAC;AACxE,OAAO,KAAK,GAAG,MAAM,aAAa,CAAC;;AAEnC,IAAI,mBAAmB,GAAG,GAAG,CAAC,mBAAmB,CAAC;;AAElD,IAAI,aAAa,GAAG;IAChB,IAAI,aAAa,EAAE,CAAC,EAAE;IACtB,OAAO,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;IAC/B,GAAG,cAAc,EAAE,CAAC,EAAE,CAAC,EAAE;IACzB,QAAQ,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE;IACzB,WAAW,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;IAC/B,cAAc,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;IACrC,KAAK,YAAY,EAAE;CACtB,CAAC;;AAEF,IAAI,QAAQ,GAAG;IACX,IAAI,KAAK,CAAC;IACV,KAAK,IAAI,CAAC;IACV,MAAM,GAAG,CAAC;CACb,CAAC;;AAEF,IAAI,SAAS,GAAG;IACZ,KAAK,GAAG,CAAC;IACT,KAAK,GAAG,CAAC;IACT,KAAK,GAAG,CAAC;CACZ,CAAC;;AAEF,SAAS,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE;IAC7B,IAAI,KAAK,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE,EAAE,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;;IAErD,SAAS,SAAS,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE;QACnC,IAAI,CAAC,IAAI,EAAE;YACP,IAAI,GAAG,OAAO,CAAC;SAClB;QACD,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;YACpC,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;SACzB;QACD,OAAO,MAAM,CAAC;KACjB;;IAED,IAAI,SAAS,GAAG,SAAS,CAAC,WAAW,CAAC,CAAC;IACvC,IAAI,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC;;IAEjC,IAAI,MAAM,EAAE;QACR,GAAG,CAAC,eAAe,EAAE,CAAC;KACzB;;IAED,KAAK,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC;QAC5B,QAAQ,CAAC;YACL,KAAK,EAAE,SAAS,OAAO,EAAE;gBACrB,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;gBACxB,IAAI,MAAM,EAAE;oBACR,IAAI,GAAG,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC;oBAC9B,IAAI,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;oBACvB,GAAG,GAAG;wBACF,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,MAAM,GAAG,EAAE,CAAC;wBACzC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,CAAC;qBAC9C,CAAC;oBACF,IAAI,IAAI,EAAE;wBACN,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;wBAC5C,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;qBAClD;oBACD,MAAM,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;iBACrB,MAAM;oBACH,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;iBACtB;aACJ;YACD,IAAI,EAAE,SAAS,OAAO,EAAE;gBACpB,IAAI,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACnD,IAAI,GAAG,GAAG,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;oBACxB,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;iBACnB;aACJ;SACJ,EAAE,OAAO,CAAC,CAAC;KACf,CAAC,CAAC;;IAEH,SAAS,IAAI,GAAG;QACZ,IAAI,EAAE,KAAK,GAAG,CAAC,EAAE;YACb,OAAO;SACV;;QAED,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACzB,QAAQ,IAAI,SAAS,CAAC,UAAU,CAAC;YACjC,KAAK,OAAO,SAAS,CAAC,OAAO,CAAC;YAC9B,MAAM,MAAM,SAAS,CAAC,QAAQ,CAAC;YAC/B,OAAO,KAAK,SAAS,CAAC,SAAS,CAAC;YAChC,QAAQ,IAAI,SAAS,CAAC,UAAU,CAAC;YACjC,OAAO,KAAK,SAAS,CAAC,SAAS,CAAC;YAChC,IAAI,QAAQ,SAAS,CAAC,MAAM,CAAC;SAChC,CAAC,CAAC;;QAEH,SAAS,QAAQ,CAAC,KAAK,EAAE;YACrB,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;;YAE5B,IAAI,GAAG,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;YAC1B,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;YACpB,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC;;;YAGjB,IAAI,SAAS,GAAG,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,WAAW,EAAE,MAAM,CAAC,EAAE,OAAO,CAAC,EAAE,SAAS,GAAG,KAAK,CAAC;YACnG,IAAI,SAAS,IAAI,MAAM,EAAE;gBACrB,IAAI,IAAI,EAAE;oBACN,IAAI,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;oBAC1B,SAAS,GAAG,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;oBACxC,SAAS,GAAG,IAAI,CAAC;oBACjB,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;oBAC9B,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;oBAClB,GAAG,CAAC,SAAS,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;oBAChE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;oBAClB,KAAK,GAAG,GAAG,CAAC;iBACf;qBACI;oBACD,SAAS,GAAG,IAAI,CAAC;iBACpB;aACJ;;YAED,IAAI,IAAI,CAAC;YACT,IAAI,GAAG,GAAG,CAAC,OAAO,CAAC;gBACf,SAAS,GAAG,SAAS;gBACrB,MAAM,MAAM,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC;gBAC7D,SAAS,GAAG,SAAS;gBACrB,SAAS,GAAG,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,WAAW,EAAE,KAAK,CAAC,EAAE,OAAO,CAAC;aAC7E,CAAC,CAAC;YACH,WAAW,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;SACjC;;QAED,IAAI,SAAS,EAAE;YACX,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACpC,MAAM;YACH,QAAQ,CAAC,KAAK,CAAC,CAAC;SACnB;;QAED,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,GAAG,CAAC,CAAC;KAC/B;;IAED,IAAI,KAAK,GAAG,CAAC,CAAC;IACd,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAC3B,GAAG,CAAC,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;CAChC;;AAED,SAAS,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAE;IAChC,MAAM,CAAC,KAAK,EAAE,SAAS,IAAI,CAAC;QACxB,QAAQ,CAAC,8BAA8B,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;KAC5D,CAAC,CAAC;CACN;;AAED,SAAS,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE;IAC7B,MAAM,CAAC,KAAK,EAAE,SAAS,IAAI,CAAC;QACxB,QAAQ,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,iBAAiB,EAAE,CAAC,CAAC,CAAC;KAC1E,CAAC,CAAC;CACN;;AAED,SAAS,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE;;;IAG9C,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,EAAE;QACxC,MAAM,CAAC,KAAK,EAAE,SAAS,IAAI,CAAC;YACxB,WAAW,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;YACnD,IAAI,QAAQ,EAAE;gBACV,QAAQ,CAAC,IAAI,CAAC,CAAC;aAClB;SACJ,CAAC,CAAC;KACN,MAAM;QACH,SAAS,CAAC,KAAK,EAAE,SAAS,OAAO,CAAC;YAC9B,WAAW,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC;YACvE,IAAI,QAAQ,EAAE;gBACV,QAAQ,CAAC,OAAO,CAAC,CAAC;aACrB;SACJ,CAAC,CAAC;KACN;CACJ;;AAED,SAAS,QAAQ,CAAC,QAAQ,EAAE,OAAO,EAAE;IACjC,IAAI,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IACzC,IAAI,OAAO,EAAE;QACT,OAAO,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;KACjD;IACD,OAAO,OAAO,CAAC;CAClB;;AAED,SAAS,WAAW,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACrC,IAAI,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE;QAC3B,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;KACvD;;IAED,IAAI,SAAS,GAAG,OAAO,CAAC,SAAS,EAAE,CAAC;IACpC,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;;IAEhC,IAAI,CAAC,IAAI,EAAE,CAAC;;IAEZ,IAAI,OAAO,IAAI,IAAI,IAAI,OAAO,GAAG,CAAC,EAAE;QAChC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;KAC5B;;IAED,gBAAgB,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IACrC,cAAc,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;;IAEnC,IAAI,SAAS,EAAE;QACX,IAAI,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC;QAC3B,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;KAChD;;IAED,WAAW,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;;IAEhC,QAAQ,CAAC;QACL,IAAI,QAAQ,QAAQ;QACpB,SAAS,GAAG,aAAa;QACzB,MAAM,MAAM,UAAU;QACtB,GAAG,SAAS,OAAO;QACnB,IAAI,QAAQ,QAAQ;QACpB,KAAK,OAAO,SAAS;QACrB,KAAK,OAAO,SAAS;QACrB,IAAI,QAAQ,QAAQ;KACvB,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;;IAEvB,IAAI,CAAC,OAAO,EAAE,CAAC;;IAEf,IAAI,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE;QAC3B,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;KACrD;CACJ;;AAED,SAAS,gBAAgB,CAAC,OAAO,EAAE,IAAI,EAAE;IACrC,IAAI,MAAM,GAAG,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;IAChD,IAAI,CAAC,MAAM,EAAE;QACT,OAAO;KACV;;IAED,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;IACzB,IAAI,KAAK,EAAE;QACP,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;QAC1B,IAAI,KAAK,IAAI,IAAI,EAAE;YACf,OAAO;SACV;QACD,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAC/C,IAAI,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE;YACd,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;SAClC;KACJ;;IAED,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;IACzB,IAAI,KAAK,IAAI,IAAI,EAAE;QACf,IAAI,KAAK,KAAK,CAAC,EAAE;YACb,OAAO;SACV;QACD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;KAC5B;;IAED,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;IAC/B,IAAI,QAAQ,EAAE;QACV,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;KACnD;;IAED,IAAI,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;IAC7B,IAAI,OAAO,EAAE;QACT,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;KACtC;;IAED,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;IAC/B,IAAI,QAAQ,EAAE;QACV,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;KACzC;;IAED,IAAI,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;IAC7B,IAAI,OAAO,IAAI,IAAI,EAAE;QACjB,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;KAClC;CACJ;;AAED,SAAS,cAAc,CAAC,OAAO,EAAE,IAAI,EAAE;IACnC,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC;IAC1C,IAAI,CAAC,IAAI,EAAE;QACP,OAAO;KACV;;IAED,IAAI,IAAI,YAAY,QAAQ,EAAE;QAC1B,OAAO;KACV;;IAED,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;IACvB,IAAI,KAAK,EAAE;QACP,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;QAC1B,IAAI,KAAK,IAAI,IAAI,EAAE;YACf,OAAO;SACV;QACD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAC7C,IAAI,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE;YACd,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;SAChC;KACJ;;IAED,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;IAC3B,IAAI,OAAO,IAAI,IAAI,EAAE;QACjB,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;KAChC;CACJ;;AAED,SAAS,WAAW,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;;IAErC,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;IAC1B,IAAI,IAAI,EAAE;QACN,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;QAC3B,IAAI,CAAC,IAAI,EAAE,CAAC;;;;KAIf;CACJ;;AAED,SAAS,UAAU,CAAC,KAAK,EAAE;IACvB,OAAO,CAAC,KAAK;YACL,CAAC,KAAK,YAAY,QAAQ;aACzB,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;cACzD,CAAC,KAAK,CAAC,KAAK,IAAI,IAAI,IAAI,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC;cACxC,CAAC,KAAK,CAAC,OAAO,IAAI,IAAI,IAAI,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;CAC7D;;AAED,SAAS,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE;IAC/C,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;IAC1B,IAAI,IAAI,YAAY,QAAQ,EAAE;QAC1B,IAAI,MAAM,EAAE;YACR,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB,MAAM;YACH,IAAI,CAAC,IAAI,EAAE,CAAC;SACf;QACD,IAAI,QAAQ,GAAG,IAAI,YAAY,cAAc,CAAC;QAC9C,IAAI,KAAK,EAAE,GAAG,CAAC;QACf,IAAI,QAAQ,EAAE;YACV,KAAK,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3D,GAAG,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC;SAC1E,MAAM;YACH,KAAK,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC;YAClD,GAAG,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC;SACrD;;QAED,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,SAAS,IAAI,CAAC;YAChD,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;YAC3B,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;gBACnB,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;aACrC,MAAM;gBACH,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;aAC/B;YACD,IAAI,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;YACrC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YAC1B,OAAO;gBACH,MAAM,EAAE,MAAM;gBACd,KAAK,EAAE,KAAK;aACf,CAAC;SACL,CAAC,CAAC;;;;QAIH,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QACxB,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;;QAEpC,IAAI,QAAQ,GAAG;YACX,SAAS,GAAG,IAAI,CAAC,SAAS,EAAE;YAC5B,IAAI,QAAQ,QAAQ,GAAG,QAAQ,GAAG,QAAQ;YAC1C,KAAK,OAAO,KAAK;YACjB,GAAG,SAAS,GAAG;YACf,KAAK,OAAO,KAAK;SACpB,CAAC;QACF,IAAI,GAAG,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QAC5B,IAAI,EAAE,GAAG,GAAG,CAAC,OAAO,EAAE,EAAE,IAAI,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;QAC7C,GAAG,GAAG;YACF,IAAI,KAAK,EAAE,CAAC,CAAC;YACb,GAAG,MAAM,EAAE,CAAC,CAAC;YACb,KAAK,IAAI,IAAI,CAAC,KAAK;YACnB,MAAM,GAAG,IAAI,CAAC,MAAM;SACvB,CAAC;QACF,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;QAC7B,OAAO,IAAI,CAAC;KACf;CACJ;;AAED,SAAS,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACzC,IAAI,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,IAAI,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE;QAC5D,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,CAAC,EAAE;YAC1C,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB;KACJ,MAAM,IAAI,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,EAAE;QACnC,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,CAAC,EAAE;YAC3C,IAAI,CAAC,IAAI,EAAE,CAAC;SACf;KACJ,MAAM,IAAI,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE;QACrC,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB,MAAM;;;QAGH,IAAI,CAAC,GAAG,EAAE,CAAC;KACd;CACJ;;AAED,SAAS,aAAa,CAAC,IAAI,EAAE,IAAI,EAAE;IAC/B,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC7B,IAAI,QAAQ,CAAC,MAAM,IAAI,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;;QAE7C,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YACtC,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,EAAE;gBACzB,OAAO,KAAK,CAAC;aAChB;YACD,CAAC,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC;SAC/B;;;QAGD,IAAI,MAAM,GAAG;YACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/E,IAAI;YACD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/E,CAAC;QACF,IAAI,MAAM,EAAE;;;YAGR,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;sBACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;sBACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC;YACtC,OAAO,IAAI,CAAC;SACf;KACJ;CACJ;;AAED,SAAS,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACnC,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;IAChC,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;QACvB,OAAO;KACV;IACD,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,EAAE;QACpC,KAAK,IAAI,IAAI,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YAC5C,IAAI,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;YACtB,IAAI,MAAM,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC;YAC1B,IAAI,CAAC,IAAI,EAAE;gBACP,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;aACnC,MAAM;gBACH,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChC,IAAI,SAAS,GAAG,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChC,IAAI,OAAO,IAAI,SAAS,EAAE;oBACtB,IAAI,CAAC,MAAM;wBACP,OAAO,CAAC,CAAC,KAAK,OAAO,CAAC,CAAC;wBACvB,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC;wBACzB,MAAM,CAAC,CAAC,MAAM,MAAM,CAAC,CAAC;qBACzB,CAAC;iBACL,MAAM;oBACH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;iBACnC;aACJ;YACD,IAAI,GAAG,GAAG,CAAC;SACd;QACD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,EAAE;YACxB,IAAI,CAAC,KAAK,EAAE,CAAC;SAChB;KACJ;CACJ;;AAED,SAAS,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IAClC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IAC9B,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;CACvC;;AAED,SAAS,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACvC,IAAI,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;IAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;QACnC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;KAClC;IACD,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;CACvC;;AAED,SAAS,UAAU,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACpC,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;IAC3B,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;IAC9C,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;CACvC;;AAED,SAAS,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACjC,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC;IAC9C,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG;QAChC,IAAI,CAAC,MAAM;YACP,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC1B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC1B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SAC7B,CAAC;KACL;IACD,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;CACvC;;AAED,SAAS,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE;IAC7B,IAAI,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACnD,IAAI,GAAG,GAAG,OAAO,CAAC,SAAS,CAAC;IAC5B,IAAI,IAAI,CAAC;IACT,IAAI,OAAO,CAAC,IAAI,EAAE,IAAI,OAAO,CAAC,MAAM,EAAE,EAAE;QACpC,IAAI,GAAG,mBAAmB,CAAC,aAAa,CAAC;KAC5C,MAAM,IAAI,OAAO,CAAC,IAAI,EAAE,EAAE;QACvB,IAAI,GAAG,mBAAmB,CAAC,IAAI,CAAC;KACnC,MAAM,IAAI,OAAO,CAAC,MAAM,EAAE,EAAE;QACzB,IAAI,GAAG,mBAAmB,CAAC,MAAM,CAAC;KACrC;;IAED,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC;IAC3D,IAAI,CAAC,SAAS,EAAE,CAAC;IACjB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;IACpD,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;IAChC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC;IACrF,IAAI,CAAC,OAAO,EAAE,CAAC;CAClB;;AAED,SAAS,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IACnC,IAAI,OAAO,CAAC,QAAQ,EAAE;QAClB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;KACxD;IACD,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;IAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;QACtC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;KACvC;CACJ;;AAED,SAAS,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE;IAC9B,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;IACxB,IAAI,CAAC,GAAG,EAAE;QACN,OAAO;KACV;;IAED,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;IAC1B,IAAI,EAAE,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;IAC1B,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;IACxB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC;IACnE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;CACvB;;AAED,SAAS,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE;IAClC,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;IAClC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC3F,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;CACvC;;AAED,SAAS,UAAU,CAAC,KAAK,EAAE;IACvB,IAAI,KAAK,GAAG,gBAAgB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAC1C,OAAO,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC;CACvC;;AAED,SAAS,QAAQ,CAAC,IAAI,EAAE;IACpB,IAAI,OAAO,GAAG,KAAK,CAAC;IACpB,IAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IAC/B,IAAI,UAAU,GAAG,IAAI,CAAC;IACtB,IAAI,OAAO,CAAC;IACZ,GAAG;QACC,OAAO,GAAG,KAAK,CAAC;QAChB,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC;KACpB,QAAQ,IAAI,IAAI,OAAO,EAAE;IAC1B,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC;;IAExC,SAAS,MAAM,CAAC,QAAQ,EAAE;QACtB,OAAO,GAAG,IAAI,CAAC;QACf,OAAO,QAAQ,CAAC;KACnB;;IAED,SAAS,OAAO,CAAC,KAAK,EAAE;QACpB,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,OAAO,EAAE,GAAG,CAAC;gBACtC,EAAE,UAAU,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;kBACxB,UAAU,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC;KAC3C;;IAED,SAAS,QAAQ,CAAC,CAAC,EAAE;QACjB,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YAC/B,IAAI,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACnB,IAAI,EAAE,IAAI,IAAI,EAAE;gBACZ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aACd;SACJ;QACD,OAAO,CAAC,CAAC;KACZ;;IAED,SAAS,YAAY,CAAC,KAAK,EAAE,CAAC,EAAE;QAC5B,IAAI,WAAW,GAAG,OAAO,CAAC;QAC1B,IAAI,UAAU,GAAG,MAAM,CAAC;;QAExB,IAAI,KAAK,CAAC,SAAS,EAAE,EAAE;YACnB,MAAM,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC;SAC5D;;QAED,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;QACxB,IAAI,IAAI,EAAE;YACN,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;YACnB,IAAI,IAAI,EAAE;gBACN,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACzB,OAAO,GAAG,OAAO,GAAG,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC;aAChE;SACJ;;QAED,IAAI;YACA,OAAO,CAAC,EAAE,CAAC;SACd;gBACO;YACJ,OAAO,GAAG,WAAW,CAAC;YACtB,MAAM,GAAG,UAAU,CAAC;SACvB;KACJ;;IAED,SAAS,SAAS,CAAC,KAAK,EAAE;QACtB,IAAI,OAAO,IAAI,IAAI,EAAE;YACjB,OAAO,KAAK,CAAC;SAChB;QACD,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACvC,IAAI,OAAO,IAAI,GAAG,EAAE;YAChB,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;SAC1C;QACD,OAAO,GAAG,CAAC;KACd;;IAED,SAAS,GAAG,CAAC,KAAK,EAAE;QAChB,OAAO,YAAY,CAAC,KAAK,EAAE,UAAU;YACjC,IAAI,CAAC,CAAC,KAAK,YAAY,KAAK,IAAI,KAAK,YAAY,SAAS,CAAC,EAAE;gBACzD,IAAI,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;gBAC3B,IAAI,CAAC,GAAG,EAAE;oBACN,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;iBACvB;gBACD,UAAU,GAAG,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,GAAG,CAAC,GAAG,GAAG,CAAC;aACnE;YACD,OAAO,QAAQ,CAAC;gBACZ,IAAI,EAAE,SAAS,KAAK,EAAE;oBAClB,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBAChD,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;gBACD,SAAS,EAAE,SAAS,KAAK,EAAE;oBACvB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBACjB,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,IAAI,EAAE,GAAG,IAAI,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBACtC,EAAE,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBACjC,IAAI,EAAE,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;wBACvB,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,EAAE,CAAC;iBACb;gBACD,MAAM,EAAE,SAAS,KAAK,EAAE;oBACpB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBACjB,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;gBACD,GAAG,EAAE,SAAS,KAAK,EAAE;oBACjB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBACjB,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;gBACD,IAAI,EAAE,SAAS,KAAK,EAAE;oBAClB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBAChD,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;gBACD,KAAK,EAAE,SAAS,KAAK,EAAE;oBACnB,IAAI,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,EAAE;wBAC3C,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;gBACD,KAAK,EAAE,SAAS,KAAK,EAAE;oBACnB,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBAClC,EAAE,CAAC,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;oBACvC,EAAE,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;oBAC7B,IAAI,KAAK,KAAK,IAAI,IAAI,EAAE,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;wBAC/D,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,EAAE,CAAC;iBACb;gBACD,IAAI,EAAE,SAAS,KAAK,EAAE;oBAClB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;wBACjB,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;oBACD,OAAO,KAAK,CAAC;iBAChB;aACJ,EAAE,KAAK,CAAC,CAAC;SACb,CAAC,CAAC;KACN;CACJ;;AAED,SAAS,SAAS,CAAC,KAAK,EAAE,OAAO,EAAE;IAC/B,IAAI,OAAO,GAAG,aAAa,EAAE,CAAC;;IAE9B,KAAK,IAAI,CAAC,IAAI,OAAO,EAAE;QACnB,IAAI,CAAC,IAAI,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE;;;;;YAKvE,SAAS;SACZ;QACD,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;KAC7C;;IAED,SAAS,CAAC,KAAK,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;;IAElC,OAAO,OAAO,CAAC;CAClB;;AAED,SAAS,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,GAAG;"}