{"version":3,"file":"surface.js","sources":["surface.js"],"sourcesContent":["import BaseSurface from '../core/surface';\nimport SurfaceFactory from '../core/surface-factory';\nimport RootNode from './root-node';\nimport Group from '../shapes/group';\nimport transform from '../geometry/transform';\nimport renderSVG from './utils/render-svg';\nimport { SVG_NS } from './constants';\nimport { bindEvents, unbindEvents, elementStyles } from '../util';\n\nconst RTL = 'rtl';\n\nfunction alignToScreen(element) {\n    let ctm;\n\n    try {\n        ctm = element.getScreenCTM ? element.getScreenCTM() : null;\n    } catch (e) { } // eslint-disable-line no-empty\n\n    if (ctm) {\n        const left = - ctm.e % 1;\n        const top = - ctm.f % 1;\n        const style = element.style;\n\n        if (left !== 0 || top !== 0) {\n            style.left = left + \"px\";\n            style.top = top + \"px\";\n        }\n    }\n}\n\nclass Surface extends BaseSurface {\n    constructor(element, options) {\n        super(element, options);\n\n        this._root = new RootNode(Object.assign({\n            rtl: elementStyles(element, 'direction').direction === RTL\n        }, this.options));\n\n        renderSVG(this.element, this._template());\n\n        this._rootElement = this.element.firstElementChild;\n\n        alignToScreen(this._rootElement);\n\n        this._root.attachTo(this._rootElement);\n\n        bindEvents(this.element, {\n            click: this._click,\n            mouseover: this._mouseenter,\n            mouseout: this._mouseleave,\n            mousemove: this._mousemove\n        });\n\n        this.resize();\n    }\n\n    destroy() {\n        if (this._root) {\n            this._root.destroy();\n            this._root = null;\n            this._rootElement = null;\n            unbindEvents(this.element, {\n                click: this._click,\n                mouseover: this._mouseenter,\n                mouseout: this._mouseleave,\n                mousemove: this._mousemove\n            });\n        }\n\n        super.destroy();\n    }\n\n    translate(offset) {\n        const viewBox = `${ Math.round(offset.x) } ${ Math.round(offset.y) } ${ this._size.width } ${ this._size.height }`;\n\n        this._offset = offset;\n        this._rootElement.setAttribute(\"viewBox\", viewBox);\n    }\n\n    draw(element) {\n        super.draw(element);\n        this._root.load([ element ]);\n    }\n\n    clear() {\n        super.clear();\n        this._root.clear();\n    }\n\n    svg() {\n        return \"<?xml version='1.0' ?>\" + this._template();\n    }\n\n    exportVisual() {\n        let { _visual: visual, _offset: offset } = this;\n\n        if (offset) {\n            const wrap = new Group();\n            wrap.children.push(visual);\n\n            wrap.transform(\n                transform().translate(-offset.x, -offset.y)\n            );\n\n            visual = wrap;\n        }\n\n        return visual;\n    }\n\n    _resize() {\n        if (this._offset) {\n            this.translate(this._offset);\n        }\n    }\n\n    _template() {\n        return `<svg style='width: 100%; height: 100%; overflow: hidden;' xmlns='${ SVG_NS }' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1'>${ this._root.render() }</svg>`;\n    }\n}\n\nSurface.prototype.type = \"svg\";\n\nif (typeof document !== \"undefined\" && document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\")) {\n    BaseSurface.support.svg = true;\n    SurfaceFactory.current.register(\"svg\", Surface, 10);\n}\n\nexport default Surface;"],"names":["const","let","super"],"mappings":"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"}