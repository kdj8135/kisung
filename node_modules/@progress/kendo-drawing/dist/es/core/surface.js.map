{"version":3,"file":"surface.js","sources":["surface.js"],"sourcesContent":["import Group from '../shapes/group';\nimport Point from '../geometry/point';\nimport SurfaceFactory from './surface-factory';\nimport { Observable } from '../common';\nimport { eventElement, eventCoordinates, elementStyles, elementSize, elementOffset } from '../util';\n\nconst events = [\n    \"click\",\n    \"mouseenter\",\n    \"mouseleave\",\n    \"mousemove\",\n    \"resize\"\n];\n\nclass Surface extends Observable {\n\n    constructor(element, options) {\n        super();\n\n        this.options = Object.assign({}, options);\n        this.element = element;\n        this.element._kendoExportVisual = this.exportVisual.bind(this);\n\n        this._click = this._handler(\"click\");\n        this._mouseenter = this._handler(\"mouseenter\");\n        this._mouseleave = this._handler(\"mouseleave\");\n        this._mousemove = this._handler(\"mousemove\");\n\n        this._visual = new Group();\n\n        elementSize(element, this.options);\n\n        this.bind(events, this.options);\n\n        this._enableTracking();\n    }\n\n    draw(element) {\n        this._visual.children.push(element);\n    }\n\n    clear() {\n        this._visual.children = [];\n    }\n\n    destroy() {\n        this._visual = null;\n        this.element._kendoExportVisual = null;\n        this.unbind();\n    }\n\n    eventTarget(e) {\n        let domNode = eventElement(e);\n        let node;\n\n        while (!node && domNode) {\n            node = domNode._kendoNode;\n            if (domNode === this.element) {\n                break;\n            }\n\n            domNode = domNode.parentElement;\n        }\n\n        if (node) {\n            return node.srcElement;\n        }\n    }\n\n    exportVisual() {\n        return this._visual;\n    }\n\n    getSize() {\n        return elementSize(this.element);\n    }\n\n    currentSize(size) {\n        if (size) {\n            this._size = size;\n        } else {\n            return this._size;\n        }\n    }\n\n    setSize(size) {\n        elementSize(this.element, size);\n\n        this.currentSize(size);\n        this._resize();\n    }\n\n    resize(force) {\n        const size = this.getSize();\n        const currentSize = this.currentSize();\n\n        if (force || (size.width > 0 || size.height > 0) && (!currentSize || size.width !== currentSize.width || size.height !== currentSize.height)) {\n            this.currentSize(size);\n            this._resize(size, force);\n            this.trigger(\"resize\", size);\n        }\n    }\n\n    size(value) {\n        if (!value) {\n            return this.getSize();\n        }\n\n        this.setSize(value);\n    }\n\n    suspendTracking() {\n        this._suspendedTracking = true;\n    }\n\n    resumeTracking() {\n        this._suspendedTracking = false;\n    }\n\n    _enableTracking() {}\n\n    _resize() {}\n\n    _handler(eventName) {\n        return (e) => {\n            const node = this.eventTarget(e);\n            if (node && !this._suspendedTracking) {\n                this.trigger(eventName, {\n                    element: node,\n                    originalEvent: e,\n                    type: eventName\n                });\n            }\n        };\n    }\n\n    _elementOffset() {\n        const element = this.element;\n        const { paddingLeft, paddingTop } = elementStyles(element, [ \"paddingLeft\", \"paddingTop\" ]);\n        const { left, top } = elementOffset(element);\n\n        return {\n            left: left + parseInt(paddingLeft, 10),\n            top: top + parseInt(paddingTop, 10)\n        };\n    }\n\n    _surfacePoint(e) {\n        const offset = this._elementOffset();\n        const coord = eventCoordinates(e);\n        const x = coord.x - offset.left;\n        const y = coord.y - offset.top;\n\n        return new Point(x, y);\n    }\n}\n\nSurface.create = function(element, options) {\n    return SurfaceFactory.current.create(element, options);\n};\n\nSurface.support = {};\n\nexport default Surface;\n"],"names":["const","super","let","this"],"mappings":"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"}