{"version":3,"file":"options-store.js","sources":["options-store.js"],"sourcesContent":["import ObserversMixin from '../mixins/observers-mixin';\nimport { Class } from '../common';\nimport { defined } from '../util';\n\nconst toString = {}.toString;\n\nclass OptionsStore extends Class {\n\n    constructor(options, prefix = \"\") {\n        super();\n\n        this.prefix = prefix;\n\n        for (let field in options) {\n            let member = options[field];\n            member = this._wrap(member, field);\n            this[field] = member;\n        }\n    }\n\n    get(field) {\n        const parts = field.split(\".\");\n        let result = this;\n\n        while (parts.length && result) {\n            let part = parts.shift();\n            result = result[part];\n        }\n\n        return result;\n    }\n\n    set(field, value) {\n        const current = this.get(field);\n\n        if (current !== value) {\n            this._set(field, this._wrap(value, field));\n            this.optionsChange({\n                field: this.prefix + field,\n                value: value\n            });\n        }\n    }\n\n    _set(field, value) {\n        const composite = field.indexOf(\".\") >= 0;\n        let parentObj = this;\n        let fieldName = field;\n\n        if (composite) {\n            const parts = fieldName.split(\".\");\n            let prefix = this.prefix;\n\n            while (parts.length > 1) {\n                fieldName = parts.shift();\n                prefix += fieldName + \".\";\n\n                let obj = parentObj[fieldName];\n\n                if (!obj) {\n                    obj = new OptionsStore({}, prefix);\n                    obj.addObserver(this);\n                    parentObj[fieldName] = obj;\n                }\n                parentObj = obj;\n            }\n            fieldName = parts[0];\n        }\n\n        parentObj._clear(fieldName);\n        parentObj[fieldName] = value;\n    }\n\n    _clear(field) {\n        const current = this[field];\n        if (current && current.removeObserver) {\n            current.removeObserver(this);\n        }\n    }\n\n    _wrap(object, field) {\n        const type = toString.call(object);\n        let wrapped = object;\n\n        if (wrapped !== null && defined(wrapped) && type === \"[object Object]\") {\n            if (!(object instanceof OptionsStore) && !(object instanceof Class)) {\n                wrapped = new OptionsStore(wrapped, this.prefix + field + \".\");\n            }\n\n            wrapped.addObserver(this);\n        }\n\n        return wrapped;\n    }\n}\n\nObserversMixin.extend(OptionsStore.prototype);\n\nexport default OptionsStore;"],"names":["const","super","let","this"],"mappings":"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"}