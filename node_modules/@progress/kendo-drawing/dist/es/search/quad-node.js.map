{"version":3,"file":"quad-node.js","sources":["quad-node.js"],"sourcesContent":["import QuadRoot from './quad-root';\nimport { Rect } from '../geometry';\nimport { append } from '../util';\n\nclass QuadNode extends QuadRoot {\n    constructor(rect) {\n        super();\n        this.children = [];\n        this.rect = rect;\n    }\n\n    inBounds(rect) {\n        const nodeRect = this.rect;\n        const nodeBottomRight = nodeRect.bottomRight();\n        const bottomRight = rect.bottomRight();\n        const inBounds = nodeRect.origin.x <= rect.origin.x && nodeRect.origin.y <= rect.origin.y && bottomRight.x <= nodeBottomRight.x &&\n            bottomRight.y <= nodeBottomRight.y;\n        return inBounds;\n    }\n\n    pointShapes(point) {\n        const children = this.children;\n        const length = children.length;\n        const result = super.pointShapes(point);\n        for (let idx = 0; idx < length; idx++) {\n            append(result, children[idx].pointShapes(point));\n        }\n        return result;\n    }\n\n    insert(shape, bbox) {\n        const children = this.children;\n        let inserted = false;\n\n        if (this.inBounds(bbox)) {\n            if (this.shapes.length < 4) {\n                this._add(shape, bbox);\n            } else {\n                if (!children.length) {\n                    this._initChildren();\n                }\n\n                for (let idx = 0; idx < children.length; idx++) {\n                    if (children[idx].insert(shape, bbox)) {\n                        inserted = true;\n                        break;\n                    }\n                }\n\n                if (!inserted) {\n                    this._add(shape, bbox);\n                }\n            }\n            inserted = true;\n        }\n\n        return inserted;\n    }\n\n    _initChildren() {\n        const { rect, children } = this;\n        const center = rect.center();\n        const halfWidth = rect.width() / 2;\n        const halfHeight = rect.height() / 2;\n\n        children.push(\n            new QuadNode(new Rect([ rect.origin.x, rect.origin.y ], [ halfWidth, halfHeight ])),\n            new QuadNode(new Rect([ center.x, rect.origin.y ], [ halfWidth, halfHeight ])),\n            new QuadNode(new Rect([ rect.origin.x, center.y ], [ halfWidth, halfHeight ])),\n            new QuadNode(new Rect([ center.x, center.y ], [ halfWidth, halfHeight ]))\n        );\n    }\n}\n\nexport default QuadNode;"],"names":["super","const","let"],"mappings":"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"}