{"version":3,"file":"path-node.js","sources":["path-node.js"],"sourcesContent":["import Node from './node';\nimport { parseColor } from '../common';\nimport { isTransparent, valueOrDefault } from '../util';\nimport LinearGradient from '../gradients/linear-gradient';\nimport RadialGradient from '../gradients/radial-gradient';\nimport { DASH_ARRAYS, SOLID, BUTT } from '../core/constants';\nimport renderPath from './utils/render-path';\nimport NODE_MAP from './node-map';\n\nfunction addGradientStops(gradient, stops) {\n    for (let idx = 0; idx < stops.length; idx++) {\n        let stop = stops[idx];\n        let color = parseColor(stop.color());\n\n        color.a *= stop.opacity();\n\n        gradient.addColorStop(stop.offset(), color.toCssRgba());\n    }\n}\n\nclass PathNode extends Node {\n\n    renderTo(ctx) {\n        ctx.save();\n\n        this.setTransform(ctx);\n        this.setClip(ctx);\n        this.setOpacity(ctx);\n\n        ctx.beginPath();\n\n        this.renderPoints(ctx, this.srcElement);\n\n        this.setLineDash(ctx);\n        this.setLineCap(ctx);\n        this.setLineJoin(ctx);\n\n        this.setFill(ctx);\n        this.setStroke(ctx);\n\n        ctx.restore();\n    }\n\n    setFill(ctx) {\n        const fill = this.srcElement.options.fill;\n        let hasFill = false;\n\n        if (fill) {\n            if (fill.nodeType === \"Gradient\") {\n                this.setGradientFill(ctx, fill);\n                hasFill = true;\n            } else if (!isTransparent(fill.color)) {\n                ctx.fillStyle = fill.color;\n\n                ctx.save();\n                this.globalAlpha(ctx, fill.opacity);\n                ctx.fill();\n                ctx.restore();\n\n                hasFill = true;\n            }\n        }\n\n        return hasFill;\n    }\n\n    setGradientFill(ctx, fill) {\n        const bbox = this.srcElement.rawBBox();\n        let gradient;\n\n        if (fill instanceof LinearGradient) {\n            let start = fill.start();\n            let end = fill.end();\n            gradient = ctx.createLinearGradient(start.x, start.y, end.x, end.y);\n        } else if (fill instanceof RadialGradient) {\n            let center = fill.center();\n            gradient = ctx.createRadialGradient(center.x, center.y, 0, center.x, center.y, fill.radius());\n        }\n\n        addGradientStops(gradient, fill.stops);\n\n        ctx.save();\n\n        if (!fill.userSpace()) {\n            ctx.transform(bbox.width(), 0, 0, bbox.height(), bbox.origin.x, bbox.origin.y);\n        }\n        ctx.fillStyle = gradient;\n        ctx.fill();\n\n        ctx.restore();\n    }\n\n    setStroke(ctx) {\n        const stroke = this.srcElement.options.stroke;\n        if (stroke && !isTransparent(stroke.color) && stroke.width > 0) {\n            ctx.strokeStyle = stroke.color;\n            ctx.lineWidth = valueOrDefault(stroke.width, 1);\n\n            ctx.save();\n            this.globalAlpha(ctx, stroke.opacity);\n            ctx.stroke();\n            ctx.restore();\n\n            return true;\n        }\n    }\n\n    dashType() {\n        const stroke = this.srcElement.options.stroke;\n        if (stroke && stroke.dashType) {\n            return stroke.dashType.toLowerCase();\n        }\n    }\n\n    setLineDash(ctx) {\n        const dashType = this.dashType();\n        if (dashType && dashType !== SOLID) {\n            const dashArray = DASH_ARRAYS[dashType];\n            if (ctx.setLineDash) {\n                ctx.setLineDash(dashArray);\n            } else {\n                ctx.mozDash = dashArray;\n                ctx.webkitLineDash = dashArray;\n            }\n        }\n    }\n\n    setLineCap(ctx) {\n        const dashType = this.dashType();\n        const stroke = this.srcElement.options.stroke;\n        if (dashType && dashType !== SOLID) {\n            ctx.lineCap = BUTT;\n        } else if (stroke && stroke.lineCap) {\n            ctx.lineCap = stroke.lineCap;\n        }\n    }\n\n    setLineJoin(ctx) {\n        const stroke = this.srcElement.options.stroke;\n        if (stroke && stroke.lineJoin) {\n            ctx.lineJoin = stroke.lineJoin;\n        }\n    }\n\n    renderPoints(ctx, path) {\n        renderPath(ctx, path);\n    }\n}\n\nNODE_MAP.Path = PathNode;\n\nexport default PathNode;\n"],"names":["let","const"],"mappings":"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"}