{"version":3,"file":"node.js","sources":["node.js"],"sourcesContent":["import BaseNode from '../core/base-node';\nimport NODE_MAP from './node-map';\nimport renderPath from './utils/render-path';\nimport { defined } from '../util';\n\nclass Node extends BaseNode {\n    constructor(srcElement) {\n        super(srcElement);\n        if (srcElement) {\n            this.initClip();\n        }\n    }\n\n    initClip() {\n        const clip = this.srcElement.clip();\n        if (clip) {\n            this.clip = clip;\n            clip.addObserver(this);\n        }\n    }\n\n    clear() {\n        if (this.srcElement) {\n            this.srcElement.removeObserver(this);\n        }\n\n        this.clearClip();\n\n        super.clear();\n    }\n\n    clearClip() {\n        if (this.clip) {\n            this.clip.removeObserver(this);\n            delete this.clip;\n        }\n    }\n\n    setClip(ctx) {\n        if (this.clip) {\n            ctx.beginPath();\n            renderPath(ctx, this.clip);\n            ctx.clip();\n        }\n    }\n\n    optionsChange(e) {\n        if (e.field === \"clip\") {\n            this.clearClip();\n            this.initClip();\n        }\n\n        super.optionsChange(e);\n    }\n\n    setTransform(ctx) {\n        if (this.srcElement) {\n            const transform = this.srcElement.transform();\n            if (transform) {\n                ctx.transform.apply(ctx, transform.matrix().toArray(6));\n            }\n        }\n    }\n\n    loadElements(elements, pos, cors) {\n        for (let i = 0; i < elements.length; i++) {\n            let srcElement = elements[i];\n            let children = srcElement.children;\n\n            let childNode = new NODE_MAP[srcElement.nodeType](srcElement, cors);\n\n            if (children && children.length > 0) {\n                childNode.load(children, pos, cors);\n            }\n\n            if (defined(pos)) {\n                this.insertAt(childNode, pos);\n            } else {\n                this.append(childNode);\n            }\n        }\n    }\n\n    load(elements, pos, cors) {\n        this.loadElements(elements, pos, cors);\n\n        this.invalidate();\n    }\n\n    setOpacity(ctx) {\n        if (this.srcElement) {\n            const opacity = this.srcElement.opacity();\n            if (defined(opacity)) {\n                this.globalAlpha(ctx, opacity);\n            }\n        }\n    }\n\n    globalAlpha(ctx, value) {\n        let opactity = value;\n        if (opactity && ctx.globalAlpha) {\n            opactity *= ctx.globalAlpha;\n        }\n        ctx.globalAlpha = opactity;\n    }\n\n    visible() {\n        const src = this.srcElement;\n        return !src || (src && src.options.visible !== false);\n    }\n}\n\nexport default Node;"],"names":["super","const","let","this"],"mappings":"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"}