{"version":3,"file":"image-node.js","sources":["image-node.js"],"sourcesContent":["import PathNode from './path-node';\nimport NODE_MAP from './node-map';\nimport { createPromise } from '../util';\n\nclass ImageNode extends PathNode {\n    constructor(srcElement, cors) {\n        super(srcElement);\n\n        this.onLoad = this.onLoad.bind(this);\n        this.onError = this.onError.bind(this);\n\n        this.loading = createPromise();\n\n        const img = this.img = new Image();\n\n        if (cors && !(/^data:/i.test(srcElement.src()))) {\n            img.crossOrigin = cors;\n        }\n\n        img.src = srcElement.src();\n\n        if (img.complete) {\n            this.onLoad();\n        } else {\n            img.onload = this.onLoad;\n            img.onerror = this.onError;\n        }\n    }\n\n    renderTo(ctx) {\n        if (this.loading.state() === \"resolved\") {\n            ctx.save();\n\n            this.setTransform(ctx);\n            this.setClip(ctx);\n\n            this.drawImage(ctx);\n\n            ctx.restore();\n        }\n    }\n\n    optionsChange(e) {\n        if (e.field === \"src\") {\n            this.loading = createPromise();\n            this.img.src = this.srcElement.src();\n        } else {\n            super.optionsChange(e);\n        }\n    }\n\n    onLoad() {\n        this.loading.resolve();\n        this.invalidate();\n    }\n\n    onError() {\n        this.loading.reject(new Error(\n            \"Unable to load image '\" + this.img.src +\n            \"'. Check for connectivity and verify CORS headers.\"\n        ));\n    }\n\n    drawImage(ctx) {\n        const rect = this.srcElement.rect();\n        const topLeft = rect.topLeft();\n\n        ctx.drawImage(\n            this.img, topLeft.x, topLeft.y, rect.width(), rect.height()\n        );\n    }\n}\n\nNODE_MAP.Image = ImageNode;\n\nexport default ImageNode;"],"names":["super","const"],"mappings":"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"}